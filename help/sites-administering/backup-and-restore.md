---
title: 백업 및 복원
seo-title: 백업 및 복원
description: AEM 컨텐츠를 백업 및 복원하는 방법을 알아봅니다.
seo-description: AEM 컨텐츠를 백업 및 복원하는 방법을 알아봅니다.
uuid: 446a466f-f508-4430-9e50-42cd4463760e
contentOwner: Guillaume Carlino
products: SG_EXPERIENCEMANAGER/6.5/SITES
topic-tags: operations
content-type: reference
discoiquuid: eb8bbb85-ca2f-4877-8ee0-bb1ee8b7d8de
exl-id: dd26dade-b769-483e-bc11-dcfa5ed1f87e
source-git-commit: b220adf6fa3e9faf94389b9a9416b7fca2f89d9d
workflow-type: tm+mt
source-wordcount: '2295'
ht-degree: 0%

---

# 백업 및 복원{#backup-and-restore}

AEM에서 저장소 컨텐츠를 백업 및 복원하는 방법에는 두 가지가 있습니다.

* 저장소의 외부 백업을 만들어 안전한 위치에 저장할 수 있습니다. 저장소가 분해되면 이전 상태로 복원할 수 있습니다.
* 저장소 컨텐츠의 내부 버전을 만들 수 있습니다. 이러한 버전은 컨텐츠와 함께 저장소에 저장되므로 변경 또는 삭제된 노드와 트리를 신속하게 복원할 수 있습니다.

## 일반 {#general}

여기에 설명된 방법은 시스템 백업 및 복구에 적용됩니다.

손실된 작은 양의 컨텐츠를 백업 및/또는 복구해야 하는 경우에는 시스템을 복구할 필요가 없습니다.

* 패키지를 통해 다른 시스템에서 데이터를 가져올 수 있습니다
* 또는 임시 시스템에서 백업을 복원하고 컨텐츠 패키지를 만들어 이 컨텐츠가 누락된 시스템에 배포합니다.

자세한 내용은 아래의 [패키지 백업](/help/sites-administering/backup-and-restore.md#package-backup)을 참조하십시오.

## 타이밍 {#timing}

두 프로세스의 결과에 영향을 줄 수 있으므로 데이터 저장소 가비지 수집과 동시에 백업을 실행하지 마십시오.

## 오프라인 백업 {#offline-backup}

항상 오프라인 백업을 수행할 수 있습니다. 이렇게 하려면 AEM의 다운타임이 필요하지만 온라인 백업에 비해 필요한 시간 측면에서 매우 효율적일 수 있습니다.

대부분의 경우 파일 시스템 스냅샷을 사용하여 해당 시점에 스토리지의 읽기 전용 복제본을 생성합니다. 오프라인 백업을 만들려면 다음 단계를 수행하십시오.

* 애플리케이션 중지
* 스냅샷 백업 만들기
* 애플리케이션 시작

스냅샷 백업은 보통 몇 초만 소요되므로 전체 다운타임이 몇 분 미만입니다.

## 온라인 백업 {#online-backup}

이 백업 방법은 AEM과 같이 그 아래에 배치된 애플리케이션을 포함하여 전체 리포지토리의 백업을 생성합니다. 백업에는 컨텐츠, 버전 기록, 구성, 소프트웨어, 핫픽스, 사용자 정의 애플리케이션, 로그 파일, 검색 인덱스 등이 포함됩니다. 클러스터링을 사용하고 있으며 공유 폴더가 `crx-quickstart` 의 하위 디렉토리인 경우(물리적으로 사용되거나 소프트링크를 사용하는 경우) 공유 디렉토리도 백업됩니다.

전체 저장소(및 모든 응용 프로그램)를 나중에 복원할 수 있습니다.

이 방법은 &quot;핫&quot; 또는 &quot;온라인&quot; 백업으로 작동하므로 저장소가 실행되는 동안 수행할 수 있습니다. 따라서 백업이 실행되는 동안 저장소를 사용할 수 있습니다. 이 방법은 기본 Tar 저장소 기반 저장소 인스턴스에 대해 작동합니다.

백업을 만들 때 다음과 같은 옵션이 있습니다.

* AEM 통합 백업 툴을 사용하여 디렉토리에 백업
* 파일 시스템 스냅샷을 사용하여 디렉토리에 백업

어떤 경우든, 백업은 저장소의 이미지(또는 스냅샷)를 생성합니다. 그런 다음 시스템 백업 에이전트가 실제로 이 이미지를 전용 백업 시스템(테이프 드라이브)으로 전송하도록 주의해야 합니다.

>[!NOTE]
>
>사용자 지정 Blob 저장소 구성이 있는 AEM 인스턴스에서 AEM Online Backup 기능을 사용하는 경우 데이터 저장소의 경로를 &quot; `crx-quickstart`&quot; 디렉토리 외부로 구성하고 데이터 저장소를 별도로 백업하는 것이 좋습니다.

>[!CAUTION]
>
>온라인 백업은 파일 시스템만 백업합니다. 저장소 컨텐츠 및/또는 저장소 파일을 데이터베이스에 저장하는 경우 해당 데이터베이스는 별도로 백업해야 합니다. MongoDB와 함께 AEM을 사용하는 경우 [MongoDB 기본 백업 도구](https://docs.mongodb.org/manual/tutorial/backup-with-mongodump/)를 사용하는 방법에 대한 설명서를 참조하십시오.

### AEM 온라인 백업 {#aem-online-backup}

리포지토리의 온라인 백업을 사용하면 백업 파일을 생성, 다운로드 및 삭제할 수 있습니다. &quot;핫&quot; 또는 &quot;온라인&quot; 백업 기능이므로 리포지토리가 읽기-쓰기 모드에서 정상적으로 사용되는 동안 실행할 수 있습니다.

>[!CAUTION]
>
>[데이터 저장소 가비지 컬렉션](/help/sites-administering/data-store-garbage-collection.md) 또는 [개정 정리](/help/sites-deploying/revision-cleanup.md#how-to-run-offline-revision-cleanup)와 동시에 AEM Online Backup을 실행하지 마십시오. 시스템 성능에 부정적인 영향을 줄 것입니다.

백업을 시작할 때 **Target 경로** 및/또는 **지연**&#x200B;을 지정할 수 있습니다.

**Target** 경로 일반적으로 백업 파일은 quickstart jar 파일(.jar)이 있는 폴더의 상위 폴더에 저장됩니다. 예를 들어 /InstallationKits/AEM 아래에 AEM jar 파일이 있으면 /InstallationKits 아래에 백업이 생성됩니다. 원하는 위치에 대상을 지정할 수도 있습니다.

**TargetPath**&#x200B;가 디렉터리인 경우 저장소의 이미지가 이 디렉토리에 생성됩니다. 동일한 디렉토리를 여러 번 사용하여 백업을 저장하는 경우

* 리포지토리의 수정된 파일은 TargetPath에서 그에 따라 수정됩니다
* 저장소에서 삭제된 파일은 TargetPath에서 삭제됩니다
* 저장소에 생성된 파일은 TargetPath에 만들어집니다

>[!NOTE]
>
>**TargetPath**&#x200B;가 확장명이 **.zip**&#x200B;인 파일 이름으로 설정된 경우 저장소가 임시 디렉토리에 백업된 다음 이 임시 디렉토리의 컨텐츠가 압축되어 ZIP 파일에 저장됩니다.
>
>이 접근법은 좌절되었습니다. 왜냐하면
>
>* 백업 프로세스 동안 추가 디스크 스토리지 필요(임시 디렉토리와 zip 파일 포함)
>* 압축 프로세스는 저장소에서 수행되며 성능에 영향을 줄 수 있습니다.
>* 백업 프로세스가 지연됩니다.
>* 최대 Java 1.6 Java는 최대 4GB의 ZIP 파일만 만들 수 있습니다.

>
>
ZIP을 백업 형식으로 만들어야 하는 경우 디렉토리에 백업한 다음 압축 프로그램을 사용하여 zip 파일을 만들어야 합니다.

**** 지연저장소 성능에 영향을 주지 않도록 시간 지연(밀리초)을 나타냅니다. 기본적으로 저장소 백업은 전체 속도로 실행됩니다. 다른 작업의 속도가 느려지지 않도록 온라인 백업 생성 속도를 줄일 수 있습니다.

매우 큰 지연을 사용하는 경우 온라인 백업이 24시간 이상 걸리지 않도록 하십시오. 모든 바이너리가 포함되지 않았을 수 있으므로 이 백업을 폐기하십시오.
1밀리초의 지연은 일반적으로 CPU 사용률을 10%로 만들고 10밀리초의 지연은 일반적으로 CPU 사용률을 3% 미만으로 합니다. 총 지연 시간(초)은 다음과 같이 예상할 수 있습니다.저장소 크기(MB), 지연 시간(밀리초), 2로 나누기(zip 옵션이 사용되는 경우) 또는 4로 나누기(디렉토리에 백업할 때). 즉, 200MB 저장소의 디렉터리로 백업하고 1ms 지연을 갖는 경우 백업 시간이 약 50초씩 증가합니다.

>[!NOTE]
>
>프로세스의 내부 세부 정보는 [AEM Online Backup 작동 방식](#how-aem-online-backup-works)을 참조하십시오.

백업을 생성하려면 다음을 수행합니다.

1. 관리자로 AEM에 로그인합니다.

1. **도구 - 작업 - 백업으로 이동합니다.**
1. **만들기**&#x200B;를 클릭합니다. 백업 콘솔이 열립니다.

   ![chlimage_1-1](assets/chlimage_1-1a.png)

1. 백업 콘솔에서 **[Target 경로](#aem-online-backup)** 및 **[지연](#aem-online-backup)**&#x200B;을 지정합니다.

   ![chlimage_1-2](assets/chlimage_1-2a.png)

   >[!NOTE]
   >
   >백업 콘솔은 다음을 사용하여 사용할 수도 있습니다.
   >
   >
   >` https://<*hostname*>:<*port-number*>/libs/granite/backup/content/admin.html`

1. **저장**&#x200B;을 클릭하면 진행률 표시줄이 백업 진행 상태를 나타냅니다.

   >[!NOTE]
   >
   >실행 중인 백업을 언제든지 **취소**&#x200B;할 수 있습니다.

1. 백업이 완료되면 백업 창에 zip 파일이 나열됩니다.

   ![chlimage_1-3](assets/chlimage_1-3a.png)

   >[!NOTE]
   >
   >더 이상 필요하지 않은 백업 파일은 콘솔을 사용하여 제거할 수 있습니다. 왼쪽 창에서 백업 파일을 선택한 다음 **삭제**&#x200B;를 클릭합니다.

   >[!NOTE]
   >
   >디렉토리에 백업한 경우:백업 프로세스가 완료되면 AEM이 대상 디렉토리에 쓰이지 않습니다.

### AEM 온라인 백업 자동화 {#automating-aem-online-backup}

가능한 경우 시스템에 로드가 거의 없는 경우(예: 아침) 온라인 백업을 실행해야 합니다.

`wget` 또는 `curl` HTTP 클라이언트를 사용하여 백업을 자동화할 수 있습니다. 다음은 curl을 사용하여 백업을 자동화하는 방법에 대한 예입니다.

#### 기본 Target 디렉터리 {#backing-up-to-the-default-target-directory}에 백업

>[!CAUTION]
>
>다음 예제에서는 인스턴스에 대해 `curl` 명령의 다양한 매개 변수를 구성해야 할 수 있습니다.예를 들어 호스트 이름( `localhost`), 포트( `4502`), 관리자 암호( `xyz`) 및 파일 이름( `backup.zip`)이 있습니다.

```shell
curl -u admin:admin -X POST http://localhost:4502/system/console/jmx/com.adobe.granite:type=Repository/op/startBackup/java.lang.String?target=backup.zip
```

백업 파일/디렉터리는 `crx-quickstart` 폴더가 포함된 폴더의 상위 폴더에 있는 서버에서 만들어집니다(브라우저를 사용하여 백업을 만드는 것과 동일). 예를 들어 `/InstallationKits/crx-quickstart/` 디렉토리에 AEM을 설치한 경우 백업이 `/InstallationKits` 디렉토리에 생성됩니다.

curl 명령은 즉시 반환되므로 이 디렉토리를 모니터링하여 zip 파일이 준비되었는지 확인해야 합니다. 백업이 작성되고 있는 동안(최종 zip 파일의 이름을 기반으로 하는 이름 포함) 임시 디렉토리를 볼 수 있으며 끝 부분에 이 디렉토리가 압축됩니다. 예:

* 결과 zip 파일 이름:`backup.zip`
* 임시 디렉터리 이름:`backup.f4d5.temp`

#### 기본이 아닌 Target 디렉터리 {#backing-up-to-a-non-default-target-directory}에 백업

일반적으로 백업 파일/디렉터리는 `crx-quickstart` 폴더가 포함된 폴더의 상위 폴더에 서버에 만들어집니다.

백업을 다른 위치에 저장하려면 `curl` 명령의 `target` 매개 변수에 절대 경로 &quot;를 설정할 수 있습니다.

예를 들어 `/Backups/2012` 디렉토리에서 `backupJune.zip`을 생성하려면 다음을 수행합니다.

```shell
curl -u admin:admin -X POST http://localhost:4502/system/console/jmx/com.adobe.granite:type=Repository/op/startBackup/java.lang.String?target=/Backups/2012/backupJune.zip"
```

>[!CAUTION]
>
>다른 응용 프로그램 서버(예: JBoss)를 사용하는 경우 대상 디렉토리에 쓸 수 없으므로 온라인 백업이 제대로 작동하지 않을 수 있습니다. 이 경우 지원 센터에 문의하십시오.

>[!NOTE]
>
>AEM](/help/sites-administering/jmx-console.md)에서 제공하는 MBeans를 사용하여 백업을 트리거할 수도 있습니다.[

### 파일 시스템 스냅샷 백업 {#filesystem-snapshot-backup}

여기에 설명된 프로세스는 대규모 저장소에 특히 적합합니다.

>[!NOTE]
>
>이 백업 방법을 사용하려면 시스템에서 파일 시스템 스냅샷을 지원해야 합니다. 예를 들어, Linux의 경우 파일 시스템을 논리 볼륨에 배치해야 합니다.

1. AEM이 배포되는 파일 시스템 스냅샷을 만듭니다.

1. 파일 시스템 스냅샷을 마운트합니다.
1. 백업을 수행하고 스냅샷을 마운트 해제합니다.

### AEM Online Backup 작동 방식 {#how-aem-online-backup-works}

AEM Online Backup은 백업되는 데이터와 작성되는 백업 파일의 무결성을 보장하기 위한 일련의 내부 작업으로 구성됩니다. 관심 있으신 분들은 아래 목록에 나와 있습니다.

온라인 백업은 다음 알고리즘을 사용합니다.

1. zip 파일을 만들 때 첫 번째 단계는 대상 디렉토리를 만들거나 찾는 것입니다.

   * zip 파일로 백업하는 경우 임시 디렉토리가 만들어집니다. 디렉터리 이름은 `backup.`으로 시작하고 `.temp`;예: `backup.f4d3.temp`
   * 디렉토리에 백업하는 경우 대상 경로에 지정된 이름이 사용됩니다. 기존 디렉토리를 사용할 수 있습니다. 그렇지 않으면 새 디렉토리가 생성됩니다.

      백업이 시작될 때 대상 디렉터리에 이름이 `backupInProgress.txt`인 빈 파일이 만들어집니다. 백업이 완료되면 이 파일이 삭제됩니다.

1. 파일은 소스 디렉토리에서 대상 디렉토리(또는 zip 파일을 만들 때 임시 디렉토리)로 복사됩니다. 저장소 손상을 방지하기 위해 세그먼트저장소는 데이터 저장소 앞에 복사됩니다. 백업을 만들 때 인덱스 및 캐시 데이터가 생략됩니다. 따라서 `crx-quickstart/repository/cache` 및 `crx-quickstart/repository/index`의 데이터는 백업에 포함되지 않습니다. zip 파일을 만들 때 프로세스의 진행률 표시줄 표시기는 0% - 70% 또는 zip 파일이 만들어지지 않을 경우 0% - 100% 사이입니다.

1. 기존 디렉토리에 백업이 수행되는 경우 대상 디렉토리의 &quot;이전&quot; 파일이 삭제됩니다. 이전 파일은 소스 디렉토리에 없는 파일입니다.

파일은 다음 네 가지 단계로 타겟 디렉토리에 복사됩니다.

1. zip 파일을 만들 때 첫 번째 복사 단계(진행 지표 0% - 63%, zip 파일이 만들어지지 않을 경우 0% - 90%)에서 저장소가 정상적으로 실행되는 동안 모든 파일이 복사됩니다. 이 프로세스에는 다음의 두 단계가 있습니다.

   * 단계 A - 데이터 저장소를 제외한 모든 항목이 지연으로 복사됩니다.
   * 단계 B - 데이터 저장소만 (지연과 함께) 복사됩니다.

1. zip 파일을 만들 때 진행률 표시기 63% - 65.8% 또는 zip 파일이 만들어지지 않으면 90% - 94%)의 두 번째 복사 단계에서는 첫 번째 복사 단계가 시작된 후 소스 디렉토리에서 만들거나 수정한 파일만 복사됩니다. 저장소의 활동에 따라 파일 없음에서 최대 많은 수의 파일이 될 수 있습니다. 첫 번째 파일 복사 스테이지는 대개 시간이 많이 걸리기 때문입니다. 복사 프로세스는 제1 단계(지연이 있는 단계 A 및 단계 B)와 유사합니다.
1. Zip 파일을 만들 때 3차 복사 단계(진행률 표시기 65.8% - 68.6%, zip 파일이 만들어지지 않으면 94% - 98%)에서는 두 번째 복사 단계가 시작된 후 소스 디렉토리에서 만들거나 수정한 파일만 복사됩니다. 저장소의 활동에 따라 복사할 파일이 없거나 매우 적은 수의 파일이 있을 수 있습니다. 두 번째 파일 복사 스테이지는 일반적으로 빠르기 때문입니다. 복사 프로세스는 2단계(Phase A 및 Phase B)와 유사하지만 지연은 없습니다.
1. 파일 복사 단계 1-3은 저장소가 실행되는 동안 모두 동시에 수행됩니다. 세 번째 복사 단계가 시작된 이후 소스 디렉터리에서 만들거나 수정한 파일만 복사됩니다. 저장소의 활동에 따라 복사할 파일이 없거나 매우 적은 수의 파일이 있을 수 있습니다. 두 번째 파일 복사 스테이지는 일반적으로 매우 빠르기 때문입니다. zip 파일을 만들 때 진행률 표시기 68.6% - 70%, zip 파일이 만들어지지 않을 경우 98% - 100% 복사 프로세스는 세 번째 단계와 유사합니다.
1. 대상에 따라 다음을 수행합니다.

   * zip 파일이 지정된 경우 이제 임시 디렉터리에서 만들어집니다. 진행률 표시기 70% - 100% 그런 다음 임시 디렉터리가 삭제됩니다.
   * 대상이 디렉터리인 경우 백업이 완료되었음을 나타내기 위해 이름이 `backupInProgress.txt`인 빈 파일이 삭제됩니다.

## 백업 {#restoring-the-backup} 복원

다음과 같이 백업을 복원할 수 있습니다.

* 파일 시스템 스냅샷 백업을 수행한 경우에는 시스템 이미지를 간단히 복원할 수 있습니다.
* 백업을 zip 파일로 만든 경우 새 폴더의 컨텐츠를 압축을 풀고 해당 위치에서 AEM을 시작합니다.

## 패키지 백업 {#package-backup}

컨텐츠를 백업 및 복원하려면 컨텐츠 패키지 형식을 사용하여 컨텐츠를 백업 및 복원하는 패키지 관리자 중 하나를 사용할 수 있습니다. 패키지 관리자는 패키지를 보다 유연하게 정의하고 관리할 수 있습니다.

이러한 각 개별 컨텐츠 패키지 형식의 기능 및 장단점에 대한 자세한 내용은 [패키지 작업 방법](/help/sites-administering/package-manager.md)을 참조하십시오.

### 백업 범위 {#scope-of-backup}

패키지 관리자 또는 컨텐츠 지퍼를 사용하여 노드를 백업하는 경우 CRX는 다음 정보를 저장합니다.

* 선택한 트리 아래의 저장소 컨텐츠.
* 백업하는 컨텐츠에 사용되는 노드 유형 정의입니다.
* 백업하는 컨텐츠에 사용되는 네임스페이스 정의입니다.

백업할 때 AEM은 다음 정보를 잃게 됩니다.

* 버전 기록.
